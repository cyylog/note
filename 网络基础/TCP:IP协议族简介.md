#### OSI网络分层介绍
网络结构的标准模型是OSI模型，由国际互联网标准化组织定义的网络分层模型。

##### 1.OSI网络分层模型
7层，同一层是对等层，对等层之间规则是一致的。
###### 什么是协议栈？
一个网络上运行的网络规则。通过协议栈的不同层可以划分为不同层。

![image-20200518214251936](/Users/drzhang/Library/Application Support/typora-user-images/image-20200518214251936.png)


##### 2.OSI的七层网络结构（从下到上）
* 物理层：物理特性（机械特性，功能特性，电器特性），传输单位是比特，网卡在物理层
* 数据链路层：可靠数据传输，物理寻址，数据成帧，数据的检测重发，流量控制以及链路控制
* 网络层：一个主机到另一个主机，有流量控制，拥塞控制等。数据单位为包
* 传输层：分段，用来保证上一层的会话层能够传输到另一方的会话层。
* 会话层：建立，终止，会话过程。主要功能是提供请求者和提供者之间的通信。
* 表示层：对数据进行处理，包括压缩，加密，以及格式的转换
* 应用层：最上层，为应用程序提供访问网络服务的接口。或者为用户提供常用的应用。

**下三层（物理层，数据链路层，网络层）是通信子网层，为上层提供通信服务。需要注意的是，OSI并不是一个网络的结构，他只是告诉我们每一层应该做什么。OSI为每一层都定义了标准，每个标准都有自己的内部标准定义。**

##### 3.OSI参考模型中的数据传输

![image-20200518212819227](/Users/drzhang/Library/Application Support/typora-user-images/image-20200518212819227.png)

* 应用程序调用应用层接口，然后进入应用层
* 应用层加上报头形成对应的协议数据单元，然后传递给下一层
* 表示层不关心传来的内容，对数据进行处理然后再加上表示层的报头，传给下一层
* 与上面类似，往下依次加上报头。在数据连裤层则不同，需要加上帧头帧尾，打包成一个数据帧，然后再传给物理层。尾部是数据的校验和用于判断数据是不是正确发送。
* 物理层将上面传输过来的数据发送出去。

主机B和主机A相反，是一个解封的过程，一次经过物，数，网，传，会，表，应，将主机B发送的数据接收和解包，最后传递给应用程序。

* 主机B物理层接收数据，送给数据链路层
* 数据链路层进行校验，如果没有出错就发给上一层网络层
* 与上面类似，依次去掉头部传递给上一层，最后到达B的应用程序中。









##### 为什么出现粘包、拆包？

* 应用程序写入的数据大于套接字缓冲区大小，这将会发生拆包
* 应用程序写入数据小于套接字缓冲区大小，网卡将应用多次写入的数据发送到网络上，这将会发生粘包。
* 进行MSS（最大报文长度）大小的TCP分段，当TCP报文长度 - TCP头部长度 > MSS的时候将发生拆包
* 接收方法不及时读取套接字缓冲区数据，这将发生粘包

##### 如何获取完整应用数据报文？

* 使用带消息头的协议，头部写入包长度，然后再读取包内容
* 设置定长消息，每次读取定长内容，长度不够时空位补固定字符。
* 设置消息边界，服务端从网络流中按消息边界分离出消息内容，一般是用'\n'

